{"version":3,"sources":["../../src/disconnect/index.js"],"names":["debug","require","app","plugin","settings","Promise","resolve","reject","client","closing","quit","log","info","id","emit"],"mappings":";;;;;;;;AACA;;AADA,MAAMA,QAAQC,QAAQ,OAAR,EAAiB,kCAAjB,CAAd;;kBAGe,CAACC,GAAD,EAAMC,MAAN,EAAcC,QAAd,KAA2B;AACxCJ,QAAM,2BAAN;AACA,SAAO,IAAIK,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,SAASL,OAAOK,MAAtB;;AAEA,QAAI,CAACA,MAAD,IAAWA,OAAOC,OAAtB,EAA+B;AAC7BT,YAAM,mEAAN;AACA,aAAOM,SAAP;AACD;;AAEDN,UAAM,6BAAN;AACAQ,WAAOE,IAAP,CAAY,MAAM;AAChBV,YAAM,gEAAN;AACAE,UAAIS,GAAJ,CAAQC,IAAR,CAAc,+BAAd,EAA8C;AAC5CT,2BAAUU,IAAIV,OAAOU,EAArB,IAA4BT,QAA5B;AAD4C,OAA9C;;AAIAJ,YAAM,sBAAN;AACAE,UAAIY,IAAJ,+BAA4B,IAA5B;;AAEAd,YAAM,yBAAN;AACAM,cAAQ,IAAR;AACD,KAXD;AAYD,GArBM,CAAP;AAsBD,C","file":"index.js","sourcesContent":["const debug = require('debug')('microjs:plugins:redis:disconnect');\nimport { EVENTS_DISCONNECT } from './../constants';\n\nexport default (app, plugin, settings) => {\n  debug('Вызван метод \"disconnect\"');\n  return new Promise((resolve, reject) => {\n    const client = plugin.client;\n  \n    if (!client || client.closing) {\n      debug('Подключение к Redis было разорвано ранее, завершаем работу метода');\n      return resolve();\n    }\n    \n    debug('Вызываем метод: client.quit');\n    client.quit(() => {\n      debug('Подключение к Redis было разорвано, сообщаем об этом в консоль');\n      app.log.info(`Подключение к Redis разорвано`, {\n        plugin: { id: plugin.id, ...settings }\n      });\n      \n      debug('Вызываем событие: %s', EVENTS_DISCONNECT);\n      app.emit(EVENTS_DISCONNECT, null);\n      \n      debug('Завершаем работу метода');\n      resolve(null);\n    });\n  });\n};"]}