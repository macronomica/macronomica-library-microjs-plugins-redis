{"version":3,"sources":["../../src/tests/tags.spec.js"],"names":["micro","level","plugins","has","get","should","before","run","then","act","after","end","describe","it","tags","have","property","Promise","all","be","a","keys","exist","equal","Object","assign","to","contain","result"],"mappings":"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","file":"tags.spec.js","sourcesContent":["import config from 'config';\nimport chai from 'chai';\nimport Microjs, { LEVEL_WARN } from '@microjs/microjs';\nimport Plugin, {\n  PIN_TAGS_GET,\n  PIN_TAGS_SET,\n  PIN_TAGS_HAS,\n  PIN_TAGS_DEL,\n  PIN_TAGS_GET_ALL,\n  PIN_TAGS_DEL_ALL\n} from '../index';\n\nconst micro = Microjs({\n  level  : LEVEL_WARN,\n  plugins: [\n    Plugin(config.has('redis') ? config.get('redis') : {})\n  ]\n});\n\nconst should = chai.should();\n\nbefore(() => micro.run()\n  .then(() => micro.act({ ...PIN_TAGS_DEL_ALL })));\n\nafter(() => micro.act({ ...PIN_TAGS_DEL_ALL })\n  .then(() => micro.end())\n);\n\ndescribe('tags', function() {\n  describe('#set', function() {\n\n    it('should set one tag', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1' ] })\n      .then(tags => tags.should.have.property('user-1'))\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n    it('вернет объект с тегами и новыми значениями', () => micro\n      .act({\n        ...PIN_TAGS_SET,\n        tags: [ 'user-1', 'user-2' ]\n      })\n      .then(tags => Promise.all([\n        tags.should.be.a('object').have.all.keys('user-1', 'user-2'),\n        tags[ 'user-1' ].should.be.a('number'),\n        tags[ 'user-2' ].should.be.a('number'),\n      ]))\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n  });\n\n  describe('#has', function() {\n\n    it('вернет true', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1' ] })\n      .then(tags => micro.act({ ...PIN_TAGS_HAS, tags }))\n      .then(exist => exist.should.be.a('boolean').equal(true))\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n    it('вернет false', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1' ] })\n      .then(tags => micro.act({ ...PIN_TAGS_HAS, tags: Object.assign(tags, { 'user-1': tags + 10 }) }))\n      .then(exist => exist.should.be.a('boolean').equal(false))\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n  });\n\n  describe('#get', function() {\n\n    it('вернет объект со значениями null для переданных тегов', () => micro\n      .act({ ...PIN_TAGS_GET, tags: [ 'user-1', 'user-2', 'user-3' ] })\n      .then(tags => tags.should.to.contain.all.keys({ 'user-1': null, 'user-2': null, 'user-3': null }))\n    );\n\n    it('вернет объект со значениями для переданных тегов', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1', 'user-2' ] })\n      .then(tags => micro\n        .act({ ...PIN_TAGS_GET, tags: [ 'user-1', 'user-2' ] })\n        .then(result => Promise.all([\n          result.should.to.contain.all.keys([ 'user-1', 'user-2' ]),\n          result[ 'user-1' ].should.equal(tags[ 'user-1' ]),\n          result[ 'user-2' ].should.equal(tags[ 'user-2' ]),\n        ]))\n      )\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n  });\n\n  describe('#del', function() {\n\n    it('вернет объект со значениtv null для переданных тегов', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1', 'user-2' ] })\n      .then(tags => micro.act({ ...PIN_TAGS_DEL, tags: [ 'user-1' ] })\n        .then(() => micro.act({ ...PIN_TAGS_GET, tags: [ 'user-1' ] }))\n        .then(result => Promise.all([\n          result.should.to.contain.all.keys([ 'user-1' ]),\n          result.should.have.property('user-1').equal(null)\n        ]))\n      )\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n  });\n\n  describe('#get-all', function() {\n\n    it('вернет объект со значениями для переданных тегов', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1', 'user-2' ] })\n      .then(tags => micro\n        .act({ ...PIN_TAGS_GET_ALL })\n        .then(result => Promise.all([\n          result.should.to.contain.all.keys([ 'user-1', 'user-2' ]),\n          result[ 'user-1' ].should.equal(tags[ 'user-1' ]),\n          result[ 'user-2' ].should.equal(tags[ 'user-2' ]),\n        ]))\n      )\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n    );\n\n  });\n\n  describe('#del-all', function() {\n\n    it('вернет объект со значениями для переданных тегов', () => micro\n      .act({ ...PIN_TAGS_SET, tags: [ 'user-1', 'user-2' ] })\n      .then(() => micro.act({ ...PIN_TAGS_DEL_ALL }))\n      .then(tags => micro.act({ ...PIN_TAGS_GET_ALL })\n        .then(result => should.equal(null, result))\n      )\n    );\n\n  });\n});\n"]}