{"version":3,"sources":["../../src/tests/cache.spec.js"],"names":["micro","level","plugins","has","get","should","key","DATA","null","undefined","number","string","boolean","date","Date","narray","barray","sarray","before","run","then","act","after","end","describe","it","result","equal","value","be","a","setCb","Promise","all","not","resolve"],"mappings":"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","file":"cache.spec.js","sourcesContent":["import config from 'config';\nimport chai from 'chai';\nimport Microjs, { LEVEL_WARN } from '@microjs/microjs';\nimport Plugin, {\n  PIN_CACHE_GET,\n  PIN_CACHE_SET,\n  PIN_CACHE_HAS,\n  PIN_CACHE_DEL\n} from '../index';\n\nconst micro = Microjs({\n  level  : LEVEL_WARN,\n  plugins: [\n    Plugin(config.has('redis') ? config.get('redis') : {})\n  ]\n});\n\nconst should = chai.should();\nconst key = 'test-key';\nexport const DATA = {\n  null       : null,\n  'undefined': undefined,\n  number     : 1,\n  string     : 'string',\n  boolean    : true,\n  date       : new Date(),\n  narray     : [ 1, 2, 3 ],\n  barray     : [ true, false ],\n  sarray     : [ 's1', 's2', 's3' ]\n};\n\nbefore(() => micro.run()\n  .then(() => micro.act({ ...PIN_CACHE_DEL, key })));\n\nafter(() => micro.act({ ...PIN_CACHE_DEL, key })\n  .then(() => micro.end()));\n\ndescribe('cache', function() {\n\n  it('#plugin.get -> должен вернуть null', () => micro\n      .act({ ...PIN_CACHE_GET, key })\n      .then(result => should.equal(null, result))\n  );\n\n  it('#plugin.set + plugin.get -> должен вернуть объект', () =>\n    micro\n      .act({ ...PIN_CACHE_SET, key, value: DATA })\n      .then(() => micro.act({ ...PIN_CACHE_GET, key }))\n      .then(result => result.should.be.a('object'))\n      .then(() => micro.act({ ...PIN_CACHE_DEL, key }))\n      .then(() => micro.act({ ...PIN_CACHE_GET, key }))\n      .then(result => should.equal(null, result))\n      .then(() => micro.act({ ...PIN_CACHE_DEL, key }))\n  );\n\n\n  it('#plugin.read + callback -> должен вернуть объект', () => micro\n    .act({ ...PIN_CACHE_GET, key, setCb: () => DATA })\n    .then(result => should.equal(result, DATA))\n    .then(() => micro.act({ ...PIN_CACHE_GET, key }))\n    .then(result => Promise.all([\n      should.not.equal(null, result),\n      result.should.be.a('object')\n    ]))\n    .then(() => micro.act({ ...PIN_CACHE_DEL, key }))\n  );\n\n  it('#plugin.read + callback():Promise -> должен вернуть объект', () => micro\n    .act({ ...PIN_CACHE_GET, key, setCb: () => Promise.resolve(DATA) })\n    .then(result => should.equal(result, DATA))\n    .then(() => micro.act({ ...PIN_CACHE_GET, key }))\n    .then(result => Promise.all([\n      should.not.equal(null, result),\n      result.should.be.a('object')\n    ]))\n    .then(() => micro.act({ ...PIN_CACHE_DEL, key })));\n});"]}