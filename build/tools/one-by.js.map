{"version":3,"sources":["../../src/tools/one-by.js"],"names":["name","prefix","findOnePin","getTags","value","request","property","Promise","resolve","key","criteria","act","then","tags"],"mappings":";;;;;;;;AAAA;;kBAEe;AAAA,MAAGA,IAAH,QAAGA,IAAH;AAAA,MAASC,MAAT,QAASA,MAAT;AAAA,MAAiBC,UAAjB,QAAiBA,UAAjB;AAAA,0BAA6BC,OAA7B;AAAA,MAA6BA,OAA7B,gCAAuCC,SAAS,EAAhD;AAAA,SAA2DC,OAAD,IAAa;AAAA,UAClEC,QADkE,GACrDD,OADqD,CAC1EL,IAD0E;;;AAGpF,QAAI,CAACM,QAAL,EAAe;AACb,aAAOC,QAAQC,OAAR,CAAgB,IAAhB,CAAP;AACD;;AAED,UAAMC,MAAO,IAAGR,MAAQ,MAAIK,QAAU,GAAtC;AACA,UAAMI,WAAW,EAAE,CAAEV,IAAF,GAAUM,QAAZ,EAAjB;;AAEA;AACA,WAAOD,QAAQM,GAAR,qCAAgCF,GAAhC,KACJG,IADI,CACCR,SAAS;AACb;AACA,UAAIA,KAAJ,EAAW;AAAE,eAAOA,KAAP;AAAc;;AAE3B;AACA,aAAOC,QAAQM,GAAR,CAAYT,WAAWQ,QAAX,CAAZ;AACL;AADK,OAEJE,IAFI,CAECR,SAASC,QACZM,GADY,qCACYF,GADZ,EACiBI,MAAMV,QAAQC,KAAR,CADvB,EACuCA,KADvC,KAEZQ,IAFY,CAEP,MAAMR,KAFC,CAFV,CAAP;AAMD,KAZI,CAAP;AAaD,GAxBc;AAAA,C","file":"one-by.js","sourcesContent":["import { PIN_CACHE_GET, PIN_CACHE_SET } from '../pins';\n\nexport default ({ name, prefix, findOnePin, getTags = value => [], }) => (request) => {\n  const { [ name ]: property } = request;\n  \n  if (!property) {\n    return Promise.resolve(null);\n  }\n  \n  const key = `${ prefix }:${ property }`;\n  const criteria = { [ name ]: property };\n  \n  // Попробуем получить из кеша по ключу\n  return request.act({ ...PIN_CACHE_GET, key })\n    .then(value => {\n      // Если нашли значение - вернем его\n      if (value) { return value }\n      \n      // Иначе - найдем новое значение\n      return request.act(findOnePin(criteria))\n        // Сгенерируем теги для значения и запишем его в кеш\n        .then(value => request\n          .act({ ...PIN_CACHE_SET, key, tags: getTags(value), value })\n          .then(() => value)\n        );\n    });\n};"]}