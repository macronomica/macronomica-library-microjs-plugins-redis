{"version":3,"sources":["../src/plugin.js"],"names":["settings","app","onClose","plugin","id","middleware","client","add","Promise","resolve","del","then","result"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;kBAEe,YAAmB;AAAA,MAAlBA,QAAkB,uEAAP,EAAO;;;AAEhC,SAAO,CAACC,GAAD,WAAsB;AAAA,QAAdC,OAAc,QAAdA,OAAc;;AAC3B,UAAMC,SAAS,EAAEC,IAAI,qBAAN,EAAeC,2BAAf,EAAf;AACA,QAAIC,SAAS,IAAb;;AAEAL,QAAIM,GAAJ,mBAAoB,MAAMC,QAAQC,OAAR,CAAgBN,MAAhB,CAA1B;AACAF,QAAIM,GAAJ,oBAAqB,MAAMC,QAAQC,OAAR,CAAgBT,QAAhB,CAA3B;AACAC,QAAIM,GAAJ,uBAAwB,MAAMC,QAAQC,OAAR,CAAgBH,MAAhB,CAA9B;;AAEAJ,YAAQ,MAAM;AACZD,UAAIS,GAAJ;AACAT,UAAIS,GAAJ;AACAT,UAAIS,GAAJ;AACA,aAAO,0BAAWT,GAAX,EAAgBE,MAAhB,EAAwBG,MAAxB,EAAgCK,IAAhC,CAAqCC,UAAUN,SAASM,MAAxD,CAAP;AACD,KALD;;AAOA,WAAO,uBAAQX,GAAR,EAAaE,MAAb,EAAqBH,QAArB,EAA+BW,IAA/B,CAAoCC,UAAUN,SAASM,MAAvD,CAAP;AACD,GAhBD;AAiBD,C","file":"plugin.js","sourcesContent":["import middleware from 'redis';\nimport { genid } from '@microjs/microjs';\nimport connect from './connect';\nimport disconnect from './disconnect';\nimport { PIN_PLUGIN, PIN_OPTIONS, PIN_CONNECTION } from './pins';\n\nexport default (settings = {}) => {\n\n  return (app, { onClose }) => {\n    const plugin = { id: genid(), middleware };\n    let client = null;\n\n    app.add(PIN_PLUGIN, () => Promise.resolve(plugin));\n    app.add(PIN_OPTIONS, () => Promise.resolve(settings));\n    app.add(PIN_CONNECTION, () => Promise.resolve(client));\n\n    onClose(() => {\n      app.del(PIN_CONNECTION);\n      app.del(PIN_OPTIONS);\n      app.del(PIN_PLUGIN);\n      return disconnect(app, plugin, client).then(result => client = result);\n    });\n\n    return connect(app, plugin, settings).then(result => client = result);\n  };\n};"]}