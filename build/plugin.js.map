{"version":3,"sources":["../src/plugin.js"],"names":["settings","app","onClose","plugin","id","middleware","client","add","Promise","resolve","del","then","result"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;kBAEe,YAAmB;AAAA,MAAlBA,QAAkB,uEAAP,EAAO;;;AAEhC,SAAO,CAACC,GAAD,WAAsB;AAAA,QAAdC,OAAc,QAAdA,OAAc;;AAC3B,UAAMC,SAAS,EAAEC,IAAI,qBAAN,EAAeC,2BAAf,EAA2BC,QAAQ,IAAnC,EAAf;;AAEAL,QAAIM,GAAJ,mBAAoB,MAAMC,QAAQC,OAAR,CAAgBN,MAAhB,CAA1B;AACAF,QAAIM,GAAJ,oBAAqB,MAAMC,QAAQC,OAAR,CAAgBT,QAAhB,CAA3B;AACAC,QAAIM,GAAJ,uBAAwB,MAAMC,QAAQC,OAAR,CAAgBN,OAAOG,MAAvB,CAA9B;;AAEA,2BAAQL,GAAR,EAAaE,MAAb,EAAqB,EAAED,OAAF,EAArB;;AAEAA,YAAQ,MAAM;AACZD,UAAIS,GAAJ;AACAT,UAAIS,GAAJ;AACAT,UAAIS,GAAJ;AACA,aAAO,0BAAWT,GAAX,EAAgBE,MAAhB,EAAwBQ,IAAxB,CAA6BC,UAAUT,OAAOG,MAAP,GAAgBM,MAAvD,CAAP;AACD,KALD;;AAOA,WAAO,uBAAQX,GAAR,EAAaE,MAAb,EAAqBH,QAArB,EAA+BW,IAA/B,CAAoCC,UAAUT,OAAOG,MAAP,GAAgBM,MAA9D,CAAP;AACD,GAjBD;AAkBD,C","file":"plugin.js","sourcesContent":["import middleware from 'redis';\nimport { genid } from '@microjs/microjs';\nimport connect from './connect';\nimport disconnect from './disconnect';\nimport modules from './modules';\nimport { PIN_PLUGIN, PIN_OPTIONS, PIN_CONNECTION } from './pins';\n\nexport default (settings = {}) => {\n\n  return (app, { onClose }) => {\n    const plugin = { id: genid(), middleware, client: null };\n\n    app.add(PIN_PLUGIN, () => Promise.resolve(plugin));\n    app.add(PIN_OPTIONS, () => Promise.resolve(settings));\n    app.add(PIN_CONNECTION, () => Promise.resolve(plugin.client));\n  \n    modules(app, plugin, { onClose });\n    \n    onClose(() => {\n      app.del(PIN_CONNECTION);\n      app.del(PIN_OPTIONS);\n      app.del(PIN_PLUGIN);\n      return disconnect(app, plugin).then(result => plugin.client = result);\n    });\n\n    return connect(app, plugin, settings).then(result => plugin.client = result);\n  };\n};"]}