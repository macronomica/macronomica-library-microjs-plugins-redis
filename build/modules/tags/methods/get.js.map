{"version":3,"sources":["../../../../src/modules/tags/methods/get.js"],"names":["reduced","ERROR_INFO","module","action","plugin","request","tags","Array","isArray","Promise","reject","length","client","hmget","then","result","catch","err","log","error","keys","values","reduceKeys","reduceValues","reduce","key","i","Object","assign","Number","value"],"mappings":";;;;;QAiCgBA,O,GAAAA,O;;AAjChB;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMC,aAAa,EAAEC,+BAAF,EAAuBC,mCAAvB,EAAnB;;AAEA;;;;;;;kBAMgBC,MAAD,IAAaC,OAAD,IAAa;AAAA,sBAChBA,OADgB,CAC9BC,IAD8B;AAAA,QAC9BA,IAD8B,iCACvB,EADuB;;AAEtC,MAAI,CAACC,MAAMC,OAAN,CAAcF,IAAd,CAAL,EAA0B;AACxB,WAAOG,QAAQC,MAAR,CAAe,+BAAqBT,UAArB,CAAf,CAAP;AACD;;AAED,MAAI,CAACK,KAAKK,MAAV,EAAkB;AAChB,WAAOF,QAAQC,MAAR,CAAe,uCAA6BT,UAA7B,CAAf,CAAP;AACD;;AAED,SAAOG,OAAOQ,MAAP,CAAcC,KAAd,sBAA8B,GAAGP,IAAjC,EACJQ,IADI,CACCC,UAAUA,WAAW,IAAX,GAAkBA,MAAlB,GAA2Bf,QAAQM,IAAR,EAAcS,MAAd,CADtC,EAEJC,KAFI,CAEEC,OAAO;AACZZ,YAAQa,GAAR,CAAYC,KAAZ,CAAkBF,GAAlB;AACA,WAAOR,QAAQC,MAAR,CAAe,6BAAcL,OAAd,EAAuBY,GAAvB,EAA4BhB,UAA5B,CAAf,CAAP;AACD,GALI,CAAP;AAMD,C;;AAGM,SAASD,OAAT,CAAiBoB,IAAjB,EAAuBC,MAAvB,EAA+B;AACpC,SAAOD,KAAKT,MAAL,GAAcU,OAAOV,MAArB,GACHW,WAAWF,IAAX,EAAiBC,MAAjB,CADG,GAEHE,aAAaH,IAAb,EAAmBC,MAAnB,CAFJ;AAGD;;AAED,SAASC,UAAT,CAAoBF,IAApB,EAA0BC,MAA1B,EAAkC;AAChC,SAAOD,KACJI,MADI,CACG,CAACT,MAAD,EAASU,GAAT,EAAcC,CAAd,KAAoB;AAC1BX,aAASY,OAAOC,MAAP,CAAcb,MAAd,EAAsB,EAAE,CAAEU,GAAF,GAASI,OAAOR,OAAQK,CAAR,CAAP,CAAX,EAAtB,CAAT;;AAEA,QAAIX,OAAQU,GAAR,MAAkB,CAAtB,EAAyB;AACvBV,aAAQU,GAAR,IAAgB,IAAhB;AACD;;AAED,WAAOV,MAAP;AACD,GATI,EASF,EATE,CAAP;AAUD;;AAED,SAASQ,YAAT,CAAsBH,IAAtB,EAA4BC,MAA5B,EAAoC;AAClC,SAAOA,OACJG,MADI,CACG,CAACT,MAAD,EAASe,KAAT,EAAgBJ,CAAhB,KAAsB;AAC5BX,aAASY,OAAOC,MAAP,CAAcb,MAAd,EAAsB,EAAE,CAAEK,KAAMM,CAAN,CAAF,GAAeG,OAAOC,KAAP,CAAjB,EAAtB,CAAT;;AAEA,QAAIf,OAAQK,KAAMM,CAAN,CAAR,MAAwB,CAA5B,EAA+B;AAC7BX,aAAQK,KAAMM,CAAN,CAAR,IAAsB,IAAtB;AACD;;AAED,WAAOX,MAAP;AACD,GATI,EASF,EATE,CAAP;AAUD","file":"get.js","sourcesContent":["import { TAGS_KEY } from './../constants';\nimport { MODULE_NAME, ACTION_NAME_GET } from '../constants';\nimport internalError from '../../../errors/internal-error';\nimport tagsMystBeArrayError from './../errors/tags-must-be-array';\nimport tagsMustBeNotEmptyArrayError from '../errors/tags-must-be-not-empty-array';\n\nconst ERROR_INFO = { module: MODULE_NAME, action: ACTION_NAME_GET };\n\n/**\n * Получает ключ TAGS_KEY из кеша с тегами и их текущими значениями\n *\n * @param {object} plugin         Экземпляр плагина\n * @returns {function({tags: Array<string>}): Promise}\n */\nexport default (plugin) => (request) => {\n  const { tags = [] } = request;\n  if (!Array.isArray(tags)) {\n    return Promise.reject(tagsMystBeArrayError(ERROR_INFO));\n  }\n  \n  if (!tags.length) {\n    return Promise.reject(tagsMustBeNotEmptyArrayError(ERROR_INFO));\n  }\n  \n  return plugin.client.hmget(TAGS_KEY, ...tags)\n    .then(result => result === null ? result : reduced(tags, result))\n    .catch(err => {\n      request.log.error(err);\n      return Promise.reject(internalError(request, err, ERROR_INFO));\n    });\n};\n\n\nexport function reduced(keys, values) {\n  return keys.length > values.length\n    ? reduceKeys(keys, values)\n    : reduceValues(keys, values);\n}\n\nfunction reduceKeys(keys, values) {\n  return keys\n    .reduce((result, key, i) => {\n      result = Object.assign(result, { [ key ]: Number(values[ i ]) });\n\n      if (result[ key ] === 0) {\n        result[ key ] = null;\n      }\n\n      return result;\n    }, {});\n}\n\nfunction reduceValues(keys, values) {\n  return values\n    .reduce((result, value, i) => {\n      result = Object.assign(result, { [ keys[ i ] ]: Number(value) });\n\n      if (result[ keys[ i ] ] === 0) {\n        result[ keys[ i ] ] = null;\n      }\n\n      return result;\n    }, {});\n}"]}