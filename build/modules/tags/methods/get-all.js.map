{"version":3,"sources":["../../../../src/modules/tags/methods/get-all.js"],"names":["reduced","ERROR_INFO","module","action","app","plugin","tags","Array","isArray","Promise","resolve","reject","client","hgetall","callback","err","result","keys","values","length","reduceKeys","reduceValues","reduce","key","i","Object","assign","value"],"mappings":";;;;;QA0CgBA,O,GAAAA,O;;AA1ChB;;AACA;;AACA;;;;;;AAEA,MAAMC,aAAa,EAAEC,+BAAF,EAAuBC,uCAAvB,EAAnB;;AAEA;;;;;;;;kBAOe,CAACC,GAAD,EAAMC,MAAN,KAAiB;AAC9B;;;;;AAKA,SAAO,UAAmB;AAAA,yBAAhBC,IAAgB;AAAA,QAAhBA,IAAgB,6BAAT,EAAS;;AACxB,QAAI,CAACC,MAAMC,OAAN,CAAcF,IAAd,CAAL,EAA0B;AACxBA,aAAO,EAAP;AACD;;AAED,WAAO,IAAIG,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCN,aAAOO,MAAP,CAAcC,OAAd,sBAAgCC,QAAhC;;AAEA,eAASA,QAAT,CAAkBC,GAAlB,EAAuBC,MAAvB,EAA+B;AAC7B,YAAID,GAAJ,EAAS;AACP,iBAAOJ,OAAO,6BAAcP,GAAd,EAAmBW,GAAnB,EAAwBd,UAAxB,CAAP,CAAP;AACD;;AAED,YAAIe,WAAW,IAAf,EAAqB;AACnB,iBAAON,QAAQM,MAAR,CAAP;AACD;;AAEDN,gBAAQV,QAAQM,IAAR,EAAcU,MAAd,CAAR;AACD;AACF,KAdM,CAAP;AAeD,GApBD;AAqBD,C;;AAEM,SAAShB,OAAT,CAAiBiB,IAAjB,EAAuBC,MAAvB,EAA+B;AACpC,SAAOD,KAAKE,MAAL,GAAcD,OAAOC,MAArB,GACHC,WAAWH,IAAX,EAAiBC,MAAjB,CADG,GAEHG,aAAaJ,IAAb,EAAmBC,MAAnB,CAFJ;AAGD;;AAED,SAASE,UAAT,CAAoBH,IAApB,EAA0BC,MAA1B,EAAkC;AAChC,SAAOD,KAAKK,MAAL,CAAY,CAACN,MAAD,EAASO,GAAT,EAAcC,CAAd,KAAoBC,OAAOC,MAAP,CAAcV,MAAd,EAAsB,EAAE,CAAEO,GAAF,GAASL,OAAQM,CAAR,CAAX,EAAtB,CAAhC,EAAiF,EAAjF,CAAP;AACD;;AAED,SAASH,YAAT,CAAsBJ,IAAtB,EAA4BC,MAA5B,EAAoC;AAClC,SAAOA,OAAOI,MAAP,CAAc,CAACN,MAAD,EAASW,KAAT,EAAgBH,CAAhB,KAAsBC,OAAOC,MAAP,CAAcV,MAAd,EAAsB,EAAE,CAAEC,KAAMO,CAAN,CAAF,GAAeG,KAAjB,EAAtB,CAApC,EAAqF,EAArF,CAAP;AACD","file":"get-all.js","sourcesContent":["import { TAGS_KEY } from './../constants';\nimport { MODULE_NAME, ACTION_NAME_GET_ALL } from '../constants';\nimport internalError from '../../../errors/internal-error';\n\nconst ERROR_INFO = { module: MODULE_NAME, action: ACTION_NAME_GET_ALL };\n\n/**\n * Получает ключ TAGS_KEY из кеша с тегами и их текущими значениями\n *\n * @param {app} app               Экземпляр библиотеки MicroJS\n * @param {object} plugin         Экземпляр плагина\n * @returns {function({tags: Array<string>}): Promise}\n */\nexport default (app, plugin) => {\n  /**\n   * @param {Array<string>} [tags]  Список имен тегов для полуения их значений\n   *\n   * @returns {Promise<null|*|error>}\n   */\n  return ({ tags = [] }) => {\n    if (!Array.isArray(tags)) {\n      tags = [];\n    }\n    \n    return new Promise((resolve, reject) => {\n      plugin.client.hgetall(TAGS_KEY, callback);\n  \n      function callback(err, result) {\n        if (err) {\n          return reject(internalError(app, err, ERROR_INFO));\n        }\n    \n        if (result === null) {\n          return resolve(result);\n        }\n    \n        resolve(reduced(tags, result));\n      }\n    });\n  };\n};\n\nexport function reduced(keys, values) {\n  return keys.length > values.length\n    ? reduceKeys(keys, values)\n    : reduceValues(keys, values);\n}\n\nfunction reduceKeys(keys, values) {\n  return keys.reduce((result, key, i) => Object.assign(result, { [ key ]: values[ i ] }), {});\n}\n\nfunction reduceValues(keys, values) {\n  return values.reduce((result, value, i) => Object.assign(result, { [ keys[ i ] ]: value }), {});\n}"]}